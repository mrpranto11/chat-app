<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Modern Chat App</title>
  <style>
    body {
      font-family: 'Segoe UI', sans-serif;
      background: #e5e5e5;
      margin: 0;
      padding: 0;
      display: flex;
      flex-direction: column;
      align-items: center;
      height: 100vh;
    }

    h2 {
      margin-top: 20px;
      color: #333;
    }

    #chat-container {
      background: #fff;
      width: 95%;
      max-width: 500px;
      height: 80vh;
      border-radius: 15px;
      box-shadow: 0 0 15px rgba(0,0,0,0.1);
      display: flex;
      flex-direction: column;
      overflow: hidden;
    }

    #messages {
      flex: 1;
      padding: 15px;
      overflow-y: auto;
      display: flex;
      flex-direction: column;
    }

    .message {
      max-width: 75%;
      padding: 10px 15px;
      margin: 8px 0;
      border-radius: 20px;
      line-height: 1.4;
      font-size: 15px;
      word-wrap: break-word;
      animation: popIn 0.3s ease-in;
    }

    .me {
      background-color: #d1f0ff;
      align-self: flex-end;
    }

    .you {
      background-color: #f0f0f0;
      align-self: flex-start;
    }

    .image-msg {
      max-width: 200px;
      border-radius: 15px;
      margin-top: 5px;
    }

    @keyframes popIn {
      from { opacity: 0; transform: scale(0.9); }
      to { opacity: 1; transform: scale(1); }
    }

    #input-area {
      display: flex;
      padding: 10px;
      border-top: 1px solid #ddd;
      background: #fafafa;
      gap: 6px;
      align-items: center;
    }

    #input {
      flex: 1;
      padding: 8px 12px;
      font-size: 14px;
      border: 1px solid #ccc;
      border-radius: 25px;
      outline: none;
    }

    #sendBtn, #imageBtn {
      background: #4caf50;
      color: white;
      border: none;
      padding: 6px 10px;
      border-radius: 25px;
      cursor: pointer;
      font-size: 14px;
      white-space: nowrap;
      transition: background 0.2s;
    }

    #sendBtn:hover, #imageBtn:hover {
      background: #45a049;
    }

    #typing-indicator {
      font-style: italic;
      font-size: 13px;
      color: #888;
      padding: 0 15px 5px;
    }

    #imageInput {
      display: none;
    }
  </style>
</head>
<body>

  <h2>ðŸ’¬ Modern Chat</h2>
  <div id="chat-container">
    <div id="messages"></div>
    <div id="typing-indicator"></div>
    <div id="input-area">
      <input id="input" type="text" placeholder="Type a message..." />
      <button id="sendBtn">Send</button>
      <button id="imageBtn">ðŸ“·</button>
      <input type="file" accept="image/*" id="imageInput" />
    </div>
  </div>

  <script>
    const socket = new WebSocket("wss://chat-app-nw1v.onrender.com");

    const messagesBox = document.getElementById("messages");
    const input = document.getElementById("input");
    const sendBtn = document.getElementById("sendBtn");
    const typingIndicator = document.getElementById("typing-indicator");
    const imageInput = document.getElementById("imageInput");
    const imageBtn = document.getElementById("imageBtn");

    // Message received
    socket.onmessage = async function(event) {
      const data = event.data instanceof Blob ? await event.data.text() : event.data;

      if (data.startsWith("data:image/")) {
        addImageMessage(data, "you");
      } else if (data === "...typing") {
        typingIndicator.textContent = "Someone is typing...";
      } else if (data === "stop_typing") {
        typingIndicator.textContent = "";
      } else {
        addMessage(data, "you");
      }
    };

    // Typing indicator
    let typingTimeout;
    input.addEventListener("input", () => {
      socket.send("...typing");
      clearTimeout(typingTimeout);
      typingTimeout = setTimeout(() => {
        socket.send("stop_typing");
      }, 1000);
    });

    // Send text
    sendBtn.onclick = () => {
      if (input.value.trim()) {
        addMessage(input.value, "me");
        socket.send(input.value.trim());
        input.value = '';
      }
    };

    // Open image selector
    imageBtn.onclick = () => imageInput.click();

    // Image selected
    imageInput.onchange = () => {
      const file = imageInput.files[0];
      if (!file) return;

      const reader = new FileReader();
      reader.onload = () => {
        const base64 = reader.result;
        addImageMessage(base64, "me");
        socket.send(base64);
      };
      reader.readAsDataURL(file);
    };

    // Add text message
    function addMessage(text, sender) {
      const div = document.createElement("div");
      div.classList.add("message", sender);
      div.textContent = text;
      messagesBox.appendChild(div);
      messagesBox.scrollTop = messagesBox.scrollHeight;
    }

    // Add image message
    function addImageMessage(base64, sender) {
      const div = document.createElement("div");
      div.classList.add("message", sender);
      const img = document.createElement("img");
      img.src = base64;
      img.className = "image-msg";
      div.appendChild(img);
      messagesBox.appendChild(div);
      messagesBox.scrollTop = messagesBox.scrollHeight;
    }
  </script>
</body>
</html>
